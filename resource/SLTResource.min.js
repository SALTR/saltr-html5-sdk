(function(d){var a=d.SALTR=d.SALTR||{};a.ResourceEvent={COMPLETE:"COMPLETE",ERROR:"ERROR"};a.Resource=function(b,e){a.EventDispatcher.apply(this);this._id=b;this._ticket=e;this._transport=null;this._dropTimeout=e._dropTimeout;this._jsonData=this._timeoutTimer=null;this.initTransport()};a.Resource.prototype=new a.EventDispatcher;a.Utils.extend(a.Resource.prototype,{initTransport:function(){var b=this._ticket.getURLRequest();this._transport=new a.Transport(b)},load:function(){this.initTransportListeners();
this._transport.load();this.startDropTimeoutTimer()},stop:function(){this.removeTransportListeners();this._transport.close();this.stopDropTimeoutTimer()},dispose:function(){this.removeEventListener(a.ResourceEvent.COMPLETE);this.removeEventListener(a.ResourceEvent.ERROR);this._transport=this._ticket=this._id=null},jsonData:function(b){if("undefined"!=typeof b)try{this._jsonData=JSON.parse(b)}catch(a){throw Error("[JSONAsset] JSON parsing Error. "+this._ticket._variables+" \n  "+b);}return this._jsonData},
initTransportListeners:function(){var b=this;this._transport.addEventListener(a.TransportEvent.COMPLETE,function(a,c){b.completeHandler(c)});this._transport.addEventListener(a.TransportEvent.ERROR,function(a,c){b.errorHandler(c)})},removeTransportListeners:function(){this._transport.removeEventListener(a.TransportEvent.COMPLETE);this._transport.removeEventListener(a.TransportEvent.ERROR)},startDropTimeoutTimer:function(){var b=this;0!=b._dropTimeout&&(b._timeoutTimer=new a.Timer(b._dropTimeout),b._timeoutTimer.addEventListener(a.TimerEvent.TIMER_COMPLETE,
function(){b.dropDropTimeoutTimer()}),b._timeoutTimer.start())},stopDropTimeoutTimer:function(){0!=this._dropTimeout&&(this._timeoutTimer.stop(),this._timeoutTimer=null)},dropDropTimeoutTimer:function(){this._timeoutTimer&&(this._transport.close(),this._timeoutTimer.removeEventListener(a.TimerEvent.TIMER_COMPLETE),this._timeoutTimer=null,this.errorHandler("[Asset] Loading is too long, so it stopped by force."))},completeHandler:function(b){this.stopDropTimeoutTimer();this.removeTransportListeners();
this.jsonData(b);this.dispatchEvent(a.ResourceEvent.COMPLETE,this)},errorHandler:function(b){this.stopDropTimeoutTimer();this.removeTransportListeners();this.dispatchEvent(a.ResourceEvent.ERROR,b)}})})(window);
