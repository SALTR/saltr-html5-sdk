<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="SLTConfig.js"></script>
	<script src="SLTUtils.js"></script>
	<script src="SLTEventDispatcher.js"></script>
	<script src="SLTTimer.js"></script>
	<script src="SLTDevice.js"></script>
	<script src="SLTDeserializer.js"></script>
	<script src="SLTFeature.js"></script>
	<script src="SLTExperiment.js"></script>

    <script src="game/SLTChunkAssetRule.js"></script>
    <script src="game/SLTAssetInstance.js"></script>
    <script src="game/SLTAsset.js"></script>
    <script src="game/SLTCompositeAsset.js"></script>
    <script src="game/SLTCompositeInstance.js"></script>
    <script src="game/SLTComposite.js"></script>
    <script src="game/SLTCellMatrixIterator.js"></script>
    <script src="game/SLTCellMatrix.js"></script>
    <script src="game/SLTCell.js"></script>
    <script src="game/SLTChunk.js"></script>
    <script src="game/SLTLevelBoardLayer.js"></script>
    <script src="game/SLTLevelBoard.js"></script>
    <script src="game/SLTLevelBoardParser.js"></script>
    <script src="game/SLTLevelSettings.js"></script>
    <script src="game/SLTLevel.js"></script>
    <script src="game/SLTLevelPack.js"></script>

    <script src="resource/SLTTransport.js"></script>
	<script src="resource/SLTResourceTicket.js"></script>
	<script src="resource/SLTResource.js"></script>
	<script src="SLTSaltr.js"></script>
</head>
<body>


<script>
    var clientKey = "283672aa-a3a0-7f98-ae37-676ac5bd7472";
    var saltrClient = new SALTR.SaltrWeb(clientKey);
    saltrClient.setSocial("123456789", "facebook");
    saltrClient.defineFeature("developerFeature", {}, true);
    //saltrClient.useNoFeatures = true;
    saltrClient.importLevelPacksFromJSON({"levelPacks":[{"index":0,"token":"PACK_2","levels":[{"id":20393,"index":0,"url":"pack_0/level_0.json","version":181}]},{"index":1,"token":"PACK_1","levels":[{"id":23407,"index":0,"url":"pack_1/level_0.json","version":38},{"id":23408,"index":1,"url":"pack_1/level_1.json","version":101},{"id":20393,"index":2,"url":"pack_1/level_2.json","version":181}]},{"index":2,"token":"PACK_3","levels":[]}]});
    //saltrClient.useNoLevels = true;
    saltrClient.start();
//    saltrClient.connect(loadCompleteHandler, loadFailedHandler);

    var levelPacks = saltrClient.levelPacks;
    var pack = levelPacks[0];
    var level = pack.levels[0];
    debugger;
    saltrClient.importLevelFromJSON('{"boards":{"UNTITLED_1":{"layers":[{"layerId":"default","chunks":[{"chunkId":1,"cells":[[0,0],[1,0],[0,1],[1,1]],"assets":[{"assetId":1592,"distributionType":"count","distributionValue":4}]}],"composites":[],"fixedAssets":[]},{"layerId":"untitled1","chunks":[],"composites":[],"fixedAssets":[]},{"layerId":"aaab","chunks":[],"composites":[],"fixedAssets":[{"assetId":1594,"cells":[[0,1],[0,0],[1,0]]},{"stateId":937,"assetId":1592,"cells":[[1,1]]}]}],"blockedCells":[[2,1],[2,0]],"rows":2,"cols":4,"cellSize":[30,30],"orientation":"BOTTOM_LEFT","position":[100,180],"properties":{"cell":[{"coords":[3,1],"value":{"aaa":"bbb"}},{"coords":[3,0],"value":{"ccc":"ddd"}}]}}},"assetStates":{"4596":"frozen","937":"frozen","4595":"frozen"},"assets":{"1593":{"states":[937],"type":"regular"},"1594":{"states":[],"type":"strawberry"},"1592":{"states":[937],"type":"regular"},"4099":{"states":[],"type":"saC"},"4091":{"states":[],"type":"rererer"}},"properties":{}}', level);
    debugger;

    //saltrClient.connect(loadCompleteHandler, loadFailedHandler);

    function loadCompleteHandler() {
        var levelPacks = saltrClient.levelPacks;
        var pack = levelPacks[0];
        var level = pack.levels[0];

        debugger;
        saltrClient.loadLevelContentData(level, levelLoadCompleteHandler, levelLoadFailedHandler);
    }

    function loadFailedHandler(error) {
        console.log(error);
    }

    function levelLoadCompleteHandler() {
        var pack = saltrClient.levelPacks[0];
        var level = pack.levels[0];

        console.log(level.boardsNode);
    }

    function levelLoadFailedHandler() {}

    function testChunk() {
        var chunkCells = [
            {"x": 0, "y": 0, "assetInstance": null, "properties": {}, "isBlocked": false},
            {"x": 1, "y": 0, "assetInstance": null, "properties": {}, "isBlocked": false},
            {"x": 0, "y": 1, "assetInstance": null, "properties": {}, "isBlocked": false},
            {"x": 1, "y": 1, "assetInstance": null, "properties": {}, "isBlocked": false}
        ];

        var chunkAssetsInfo = [
            {
                "assetId": "1592",
                "stateId": null,
                "distributionType": "count",
                "distributionValue": 4
            }
        ];

        var levelSettings = {
            assetMap: {
                1592: {
                    keys: null,
                    type: "regular"
                },
                1593: {
                    keys: null,
                    type: "regular"
                },
                1594: {
                    keys: null,
                    type: "strawberry"
                },
                4091: {
                    keys: null,
                    type: "rererer"
                },
                4099: {
                    keys: null,
                    type: "saC"
                }
            },
            stateMap: {
                937: "frozen"
            },
            keySetMap: null
        };

        var chunk = SALTR.Chunk(chunkCells, chunkAssetsInfo, levelSettings);
        chunk.generate();
        debugger;
    }
</script>

</body>
</html>
